<!doctype html>
<html lang="en">
<head>
  <script src="http://localhost:55011/test/jquery-3.3.1.js"></script>

</head>
<body>
 
User name: <input id="uname" type="text" name="fname" value="admin@dxc.com"><br>
Password name: <input id="upsw" type="text" name="lname" value="123456"><br>

1. First click <button id="btn01">Get login tocken</button>
</br>
Return login data: <input id="loginData" type="text" name="lname" value="" style="width:1500px;"><br>
</br>
2. And then use tocken to call other methods like <button id="btn02">Get all Users</button>
<div>
All users: <p id="allUserData"></p><br>
</div>

<div>
	More General Testing:
	<div>URL:<input id="testURL" type="text" name="fname" value="http://localhost:55011/api" style="width:1500px;"><br></div>
	Input Data: <textarea cols="50" rows="20"  id ="inputData"></textarea> <br>
	Method: <select id="methodOption">
		<option value="GET">GET</option>
		<option value="POST">POST</option>
		<option value="PUT">PUT</option>
		<option value="DELETE">DELETE</option>
	</select> <br>
	<button id="btn03">Submit</button><br>
	Return Data: <textarea cols="50" rows="20"  id ="outputData"></textarea> <br>
</div>
 
<script>
$("#btn01").click(function() {
	var userName = $("#uname").val();
	var psw = $("#upsw").val();

	$.ajax({
	    url: 'http://localhost:55011/oauth2/token',
	    headers: {
	        'Accept':'application/json',
	        'Content-Type':'application/x-www-form-urlencoded'
	    },
	    method: 'POST',
	    dataType: 'json',
	    data: 'username=' + userName + '&password='+ psw +'&grant_type=password',
	    success: function(json) {
        	$("#loginData").val(json.access_token);
    	},
    	error: function(data) {
          //console.log(data);
          var responseText=JSON.parse(data.responseText);
          alert($.param(responseText));
     		}
	});
});

$("#btn02").click(function() {
	var tocken = 'bearer '+ $("#loginData").val();

	$.ajax({
	    url: 'http://localhost:55011/api/ShqUsers/All',
	    headers: {
	        'Authorization': tocken,
		'contentType': 'application/json'
	    },
	    method: 'GET',
	    dataType: 'json',
	    data: '',
	    success: function(json) {   
        	$("#allUserData").html(JSON.stringify(json));
    	},
    	error: function(data) {
          //console.log(data);
          var responseText=JSON.parse(data.responseText);
          alert($.param(responseText));
     		}
	});
});

$("#btn03").click(function() {
	var url = $('#testURL').val();
	var method = $('#methodOption').val();
	var tocken = 'bearer '+ $("#loginData").val();
	var tempdata = $('#inputData').val();
	if(tempdata == '')
	{
		tempdata = '{}'
	}
	var inputdata = $.parseJSON(tempdata);

	if(method == "GET"||method == "DELETE")
	{
		inputdata='';
	}
	else
	{
		if(tempdata=='{}')
		{
			$("#outputData").html('Please input json request data first.');
			return;
		}
	}

	$("#outputData").html("");

	$.ajax({
	    url: url,
	    headers: {
	        'Authorization': tocken
	    },
	    type: method,
		contentType: 'application/json',
	    dataType: 'json',
	    data: tempdata,
	    success: function(json) {   
        	$("#outputData").html(JSON.stringify(json));
    	},
    	error: function(data) {
          var responseText=JSON.parse(data.responseText);
          $("#outputData").html(JSON.stringify(responseText));
     		}
	});

});

</script>
</body>
</html>